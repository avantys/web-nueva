---
// src/components/common/Header.astro
import { NAVIGATION_LINKS, CONTACT_INFO } from '../../utils/constants';
import { withBase } from '../../utils/paths';
---

<nav class="site-header">
  <div class="container-custom">
    <div class="site-header-grid">
      <!-- Logo -->
      <div class="flex items-center">
        <a href={withBase('/')} class="logo-link" aria-label="Avantys - Inicio">
          <img src={withBase('/images/logo.svg')} alt="Avantys - Logo" class="logo-img" width="180" height="48" loading="eager" decoding="async" />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="nav">
        <div class="nav-list">
          {NAVIGATION_LINKS.map((link) => {
            const color = (link.color ?? 'primary') as 'primary'|'comienza'|'crece'|'crea'|'transforma';
              const hasSub = Array.isArray(link.submenu) && link.submenu.length > 0;
              const key = link.name.toLowerCase();
              const isComienza = hasSub && key === 'comienza';
              const isCrece = hasSub && key === 'crece';
              const isCrea = hasSub && key === 'crea';
              const isTransforma = hasSub && key === 'transforma';

            return (
              <div class="relative group">
                {hasSub ? (
                  <button class={`nav-trigger hover-${color}`} data-dropdown-toggle={link.name.toLowerCase()} aria-haspopup="true" aria-expanded="false">
                    {link.name}
                    <svg class="ml-1 h-4 w-4 transition-transform duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                ) : (
                  <a href={withBase(link.href)} class={`nav-trigger hover-${color}`}>{link.name}</a>
                )}

                  {/* Megamenús personalizados */}
                  {isComienza && (
                    <div class="grid grid-cols-12">
                      <!-- Promos izquierda -->
                      <div class="col-span-5 p-6 border-r border-border-light">
                        <div class="space-y-4">
                          <div class="promo-card">
                            <h3 class="text-base font-bold text-text-primary">Tu sitio web más rápido y seguro</h3>
                            <p class="text-sm text-text-secondary mt-1">Descubre nuestro hosting web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe.</p>
                            <a href={withBase('/comienza/hosting')} class="menu-cta bgbtn-comienza mt-3">Más información</a>
                          </div>
                          <div class="promo-card">
                            <h3 class="text-base font-bold text-text-primary">Administramos tus servidores o proyectos</h3>
                            <p class="text-sm text-text-secondary mt-1">Concéntrate en tu negocio mientras nosotros nos ocupamos 24/7.</p>
                            <a href={withBase('/transforma/administracion-servidores')} class="menu-cta bgbtn-transforma mt-3">Más información</a>
                          </div>
                        </div>
                      </div>

                      <!-- Links derecha -->
                      <div class="col-span-7 p-6">
                        <div class="menu-grid">
                          <div>
                            <h4 class="menu-title">Dominios</h4>
                            <div class="menu-block">
                              <a href={withBase('/comienza/dominios')} class="menu-link">
                                <div class="flex items-start gap-3">
                                  <div class="icon-badge tintbg-comienza"><svg class="w-4 h-4 tint-comienza" viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                  <div class="flex-1">
                                    <div class="text-sm font-semibold text-text-primary">Comprar Dominio</div>
                                    <p class="text-xs text-text-secondary mt-1">Elige y registra el dominio ideal para tu proyecto.</p>
                                  </div>
                                </div>
                              </a>
                              <a href={withBase('/comienza/dominios')} class="menu-link">
                                <div class="flex items-start gap-3">
                                  <div class="icon-badge tintbg-comienza"><svg class="w-4 h-4 tint-comienza" viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                  <div class="flex-1">
                                    <div class="text-sm font-semibold text-text-primary">Transferir Dominio</div>
                                    <p class="text-xs text-text-secondary mt-1">Transfiere tu dominio: rápido y sin complicaciones.</p>
                                  </div>
                                </div>
                              </a>
                            </div>
                          </div>

                          <div>
                            <h4 class="menu-title">Hosting</h4>
                            <div class="menu-block">
                              <a href={withBase('/comienza/hosting-wordpress')} class="menu-link">
                                <div class="flex items-start gap-3">
                                  <div class="icon-badge tintbg-comienza"><svg class="w-4 h-4 tint-comienza" viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                  <div class="flex-1">
                                    <div class="text-sm font-semibold text-text-primary">Hosting WordPress</div>
                                    <p class="text-xs text-text-secondary mt-1">WordPress optimizado: rápido, seguro y siempre actualizado.</p>
                                  </div>
                                </div>
                              </a>
                              <a href={withBase('/comienza/hosting')} class="menu-link">
                                <div class="flex items-start gap-3">
                                  <div class="icon-badge tintbg-comienza"><svg class="w-4 h-4 tint-comienza" viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                  <div class="flex-1">
                                    <div class="text-sm font-semibold text-text-primary">Hosting Web</div>
                                    <p class="text-xs text-text-secondary mt-1">Hosting web robusto para sitios dinámicos y escalables.</p>
                                  </div>
                                </div>
                              </a>
                            </div>
                          </div>
                        </div>

                        <div class="mt-5 pt-4 border-t border-border-light">
                          <a href={withBase(link.href)} class="menu-cta bgbtn-comienza">Ver todos los servicios de {link.name}</a>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                  {isCrea && (
                      <div class="grid grid-cols-12">
                        <div class="col-span-5 p-6 border-r border-border-light">
                          <div class="space-y-4">
                            <div class="promo-card">
                              <h3 class="text-base font-bold text-text-primary">Sobre Avantys</h3>
                              <p class="text-sm text-text-secondary mt-1">Descubre nuestras soluciones de alojamiento web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe, diseñadas para impulsar la velocidad y seguridad de tu sitio web.</p>
                              <a href={withBase('/sobre-avantys')} class={`menu-cta bgbtn-${color} mt-3`}>Más información</a>
                            </div>
                            <div class="promo-card">
                              <h3 class="text-base font-bold text-text-primary">Sobre Avantys</h3>
                              <p class="text-sm text-text-secondary mt-1">Descubre nuestras soluciones de alojamiento web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe, diseñadas para impulsar la velocidad y seguridad de tu sitio web.</p>
                              <a href={withBase('/sobre-avantys')} class={`menu-cta bgbtn-${color} mt-3`}>Más información</a>
                            </div>
                          </div>
                        </div>

                        <div class="col-span-7 p-6">
                          <div class="menu-grid grid-cols-1">
                            <div class="menu-block">
                              <a href={withBase('/crea/desarrollo-web')} class="menu-link">
                                <div class="flex items-start gap-3">
                                  <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                  <div class="flex-1">
                                    <div class="text-sm font-semibold text-text-primary">Desarrollo Web</div>
                                    <p class="text-xs text-text-secondary mt-1">Webs que conectan, convencen y convierten.</p>
                                  </div>
                                </div>
                              </a>
                              <a href={withBase('/crea/creador-web')} class="menu-link">
                                <div class="flex items-start gap-3">
                                  <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                  <div class="flex-1">
                                    <div class="text-sm font-semibold text-text-primary">Creador de webs gratuito</div>
                                    <p class="text-xs text-text-secondary mt-1">Creatividad visual que impulsa tu marca al siguiente nivel.</p>
                                  </div>
                                </div>
                              </a>
                            </div>
                          </div>

                          <div class="mt-5 pt-4 border-t border-border-light">
                            <a href={withBase(link.href)} class={`menu-cta bgbtn-${color}`}>Ver todos los servicios de {link.name}</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {isCrece && (
                      <div class="grid grid-cols-12">
                        <div class="col-span-5 p-6 border-r border-border-light">
                          <div class="space-y-4">
                            <div class="promo-card">
                              <h3 class="text-base font-bold text-text-primary">Sobre Avantys</h3>
                              <p class="text-sm text-text-secondary mt-1">Descubre nuestras soluciones de alojamiento web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe, diseñadas para impulsar la velocidad y seguridad de tu sitio web.</p>
                              <a href={withBase('/sobre-avantys')} class={`menu-cta bgbtn-${color} mt-3`}>Más información</a>
                            </div>
                            <div class="promo-card">
                              <h3 class="text-base font-bold text-text-primary">Sobre Avantys</h3>
                              <p class="text-sm text-text-secondary mt-1">Descubre nuestras soluciones de alojamiento web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe, diseñadas para impulsar la velocidad y seguridad de tu sitio web.</p>
                              <a href={withBase('/sobre-avantys')} class={`menu-cta bgbtn-${color} mt-3`}>Más información</a>
                            </div>
                          </div>
                        </div>

                        <div class="col-span-7 p-6">
                          <div class="menu-grid grid-cols-3">
                            <a href={withBase('/crece/growth-360')} class="menu-link">
                              <div class="flex items-start gap-3">
                                <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                <div class="flex-1">
                                  <div class="text-sm font-semibold text-text-primary">Growth 360</div>
                                  <p class="text-xs text-text-secondary mt-1">Estrategias digitales que impulsan tu marca hacia el éxito en línea.</p>
                                </div>
                              </div>
                            </a>
                            <a href={withBase('/crece/redes-sociales')} class="menu-link">
                              <div class="flex items-start gap-3">
                                <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                <div class="flex-1">
                                  <div class="text-sm font-semibold text-text-primary">Redes Sociales</div>
                                  <p class="text-xs text-text-secondary mt-1">Conecta, interactúa y crece con tu audiencia.</p>
                                </div>
                              </div>
                            </a>
                            <a href={withBase('/crece/marketing-deportivo')} class="menu-link">
                              <div class="flex items-start gap-3">
                                <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                <div class="flex-1">
                                  <div class="text-sm font-semibold text-text-primary">Marketing Deportivo</div>
                                  <p class="text-xs text-text-secondary mt-1">Gestión de marcas y eventos con los deportistas.</p>
                                </div>
                              </div>
                            </a>
                          </div>

                          <div class="mt-5 pt-4 border-t border-border-light">
                            <a href={withBase(link.href)} class={`menu-cta bgbtn-${color}`}>Ver todos los servicios de {link.name}</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {isTransforma && (
                      <div class="grid grid-cols-12">
                        <div class="col-span-5 p-6 border-r border-border-light">
                          <div class="space-y-4">
                            <div class="promo-card">
                              <h3 class="text-base font-bold text-text-primary">Sobre Avantys</h3>
                              <p class="text-sm text-text-secondary mt-1">Descubre nuestras soluciones de alojamiento web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe, diseñadas para impulsar la velocidad y seguridad de tu sitio web.</p>
                              <a href={withBase('/sobre-avantys')} class={`menu-cta bgbtn-${color} mt-3`}>Más información</a>
                            </div>
                            <div class="promo-card">
                              <h3 class="text-base font-bold text-text-primary">Sobre Avantys</h3>
                              <p class="text-sm text-text-secondary mt-1">Descubre nuestras soluciones de alojamiento web con cPanel, CloudLinux y LiteSpeed en discos SSD NVMe, diseñadas para impulsar la velocidad y seguridad de tu sitio web.</p>
                              <a href={withBase('/sobre-avantys')} class={`menu-cta bgbtn-${color} mt-3`}>Más información</a>
                            </div>
                          </div>
                        </div>

                        <div class="col-span-7 p-6">
                          <div class="menu-grid grid-cols-4">
                            <div>
                              <h4 class="menu-title">Cloud</h4>
                              <div class="menu-block">
                                <a href={withBase('/transforma/cloud')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">Instancias Cloud</div>
                                      <p class="text-xs text-text-secondary mt-1">Escalabilidad instantánea sin límites con administrador dedicado.</p>
                                    </div>
                                  </div>
                                </a>
                                <a href={withBase('/transforma/cloud-dedicado')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">Instancias dedicadas</div>
                                      <p class="text-xs text-text-secondary mt-1">Potencia exclusiva para proyectos críticos.</p>
                                    </div>
                                  </div>
                                </a>
                              </div>
                            </div>

                            <div>
                              <h4 class="menu-title">Servidores</h4>
                              <div class="menu-block">
                                <a href={withBase('/transforma/vps-linux')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">VPS Linux</div>
                                      <p class="text-xs text-text-secondary mt-1">Potencia y control total con Linux.</p>
                                    </div>
                                  </div>
                                </a>
                                <a href={withBase('/transforma/vps-windows')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">VPS Windows</div>
                                      <p class="text-xs text-text-secondary mt-1">El servidor compatible para tu entorno Microsoft.</p>
                                    </div>
                                  </div>
                                </a>
                                <a href={withBase('/transforma/vps-trader')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">VPS Trader</div>
                                      <p class="text-xs text-text-secondary mt-1">Rendimiento optimizado para entornos de trading.</p>
                                    </div>
                                  </div>
                                </a>
                              </div>
                            </div>

                            <div>
                              <h4 class="menu-title">Administración de servidores</h4>
                              <div class="menu-block">
                                <a href={withBase('/transforma/administracion-servidores')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">Administración de servidores</div>
                                      <p class="text-xs text-text-secondary mt-1">Maximiza el potencial de tu infraestructura con gestión proactiva y soporte 24/7.</p>
                                    </div>
                                  </div>
                                </a>
                              </div>
                            </div>

                            <div>
                              <h4 class="menu-title">Paneles de Control</h4>
                              <div class="menu-block">
                                <a href={withBase('/transforma/paneles-control')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">cPanel</div>
                                      <p class="text-xs text-text-secondary mt-1">Control total con la interfaz líder del mercado.</p>
                                    </div>
                                  </div>
                                </a>
                                <a href={withBase('/transforma/paneles-control')} class="menu-link">
                                  <div class="flex items-start gap-3">
                                    <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                    <div class="flex-1">
                                      <div class="text-sm font-semibold text-text-primary">Plesk</div>
                                      <p class="text-xs text-text-secondary mt-1">La alternativa flexible para tu servidor.</p>
                                    </div>
                                  </div>
                                </a>
                              </div>
                            </div>
                          </div>

                          <div class="mt-5 pt-4 border-t border-border-light">
                            <a href={withBase(link.href)} class={`menu-cta bgbtn-${color}`}>Ver todos los servicios de {link.name}</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Dropdown simple para el resto */}
                  {!(isComienza || isCrece || isCrea || isTransforma) && hasSub && (
                    <div class="p-4 grid grid-cols-1 gap-2">
                      {link.submenu!.map((sublink) => (
                        <a href={withBase(sublink.href)} class="menu-link">
                          <div class="flex items-start gap-3">
                            <div class={`icon-badge tintbg-${color}`}><svg class={`w-4 h-4 tint-${color}`} viewBox="0 0 20 20" fill="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                            <div class="flex-1">
                              <h3 class="text-sm font-semibold text-text-primary">{sublink.name}</h3>
                            </div>
                          </div>
                        </a>
                      ))}
                    </div>
                    <div class="mt-3 pt-3 border-t border-border-light">
                      <a href={withBase(link.href)} class={`menu-cta bgbtn-${color} w-full text-center`}>Ver todos los servicios de {link.name}</a>
                    </div>
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </div>

      <!-- Acciones -->
      <div class="flex items-center justify-end gap-4">
        <a href={CONTACT_INFO.clientPanel} target="_blank" rel="noopener noreferrer" class="btn-client">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
          Área del cliente
        </a>

        <button type="button" class="btn-burger" aria-controls="mobile-menu" aria-expanded="false" id="mobile-menu-button">
          <span class="sr-only">Abrir menú principal</span>
          <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
      </div>
    </div>

    <!-- Mobile -->
    <div class="lg:hidden hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1 bg-white border-t border-border-light">
        {NAVIGATION_LINKS.map((link) => (
          <div>
            <a href={withBase(link.href)} class="mobile-link">{link.name}</a>
            {Array.isArray(link.submenu) && link.submenu.length > 0 && (
              <div class="ml-4 space-y-1">
                {link.submenu.map((sublink) => (
                  <a href={withBase(sublink.href)} class="mobile-sublink">{sublink.name}</a>
                ))}
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  </div>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    if (btn && menu) {
      btn.addEventListener('click', () => {
        const isHidden = menu.classList.contains('hidden');
        menu.classList.toggle('hidden', !isHidden);
        btn.setAttribute('aria-expanded', String(isHidden));
      });

      document.addEventListener('click', (e) => {
        const t = e.target;
        if (!(t instanceof Node)) return;
        if (!menu.contains(t) && !btn.contains(t)) {
          menu.classList.add('hidden');
          btn.setAttribute('aria-expanded', 'false');
        }
      }, true);
    }

    const dropdownButtons = document.querySelectorAll('.nav-trigger[data-dropdown-toggle]');
    dropdownButtons.forEach((button) => {
      const target = button.getAttribute('data-dropdown-toggle');
      if (!target) return;
      const panel = document.getElementById(target);
      if (!panel) return;

      button.addEventListener('click', () => {
        const isOpen = panel.getAttribute('data-open') === 'true';
        document.querySelectorAll('.dropdown-panel[data-open="true"]').forEach((p) => {
          p.setAttribute('data-open', 'false');
        });
        panel.setAttribute('data-open', String(!isOpen));
        button.setAttribute('aria-expanded', String(!isOpen));
      });

      document.addEventListener('click', (e) => {
        const t = e.target;
        if (!(t instanceof Node)) return;
        if (!panel.contains(t) && !button.contains(t)) {
          panel.setAttribute('data-open', 'false');
          button.setAttribute('aria-expanded', 'false');
        }
      });
    });
  });
</script>

<style>
  @media (hover: hover) {
    .group:hover [aria-haspopup="true"] svg { transform: rotate(180deg); transition: transform .2s ease; }
  }
</style>